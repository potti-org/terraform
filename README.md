<p align="center">
  <img src="https://img.shields.io/badge/Terraform-v1.0+-623CE4?style=for-the-badge&logo=terraform" alt="Terraform">
  <img src="https://img.shields.io/badge/OVHcloud-Public_Cloud-123F6D?style=for-the-badge&logo=ovh" alt="OVHcloud">
  <img src="https://img.shields.io/badge/Security-Zero_Trust-00A86B?style=for-the-badge&logo=shield" alt="Security">
</p>

# ğŸ—ï¸ Potti Infrastructure

> Enterprise-grade Terraform configuration for the Potti application infrastructure hosted on OVHcloud Public Cloud with defense-in-depth security architecture.

---

## ğŸ“‹ Table of Contents

- [Architecture Overview](#-architecture-overview)
- [Security Architecture](#-security-architecture)
- [Network Topology](#-network-topology)
- [Components](#-components)
- [Data Flow](#-data-flow)
- [High Availability](#-high-availability)
- [Terraform Resources](#-terraform-resources)
- [Quick Start](#-quick-start)
- [Compliance](#-compliance)

---

## ğŸ›ï¸ Architecture Overview

### High-Level System Architecture

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                         ğŸŒ INTERNET                                                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    â”‚                           â”‚                           â”‚
                    â”‚                           â”‚                           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    â˜ï¸ CLOUDFLARE     â”‚     â”‚   ğŸ‘¤ DEVELOPERS      â”‚     â”‚   ğŸ”§ LARAVEL FORGE   â”‚
         â”‚        DNS          â”‚     â”‚   (French IPs)       â”‚     â”‚   (Whitelisted)     â”‚
         â”‚   potti.co â†’ LB     â”‚     â”‚                      â”‚     â”‚   159.203.150.x     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                           â”‚                           â”‚
                    â”‚ :443 HTTPS                â”‚ :22 SSH                   â”‚ :22 SSH
                    â”‚                           â”‚                           â”‚
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                    ğŸ”’ OVHcloud PUBLIC CLOUD                                           â•‘
â•‘                                       EU-WEST-PAR Region                                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                                       â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘    â”‚                           âš–ï¸ LOAD BALANCER (Floating IP)                                     â”‚   â•‘
â•‘    â”‚                                                                                              â”‚   â•‘
â•‘    â”‚    HTTP :80 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ HTTPS :443 Redirect  â”‚   â•‘
â•‘    â”‚    HTTPS :443 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Round Robin Pool      â”‚   â•‘
â•‘    â”‚    TCP :49984 (IoT) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Round Robin Pool      â”‚   â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘                                              â”‚                                                        â•‘
â•‘    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—    â•‘
â•‘    â•‘                         ğŸ” PRIVATE NETWORK (vRack) - 10.101.0.0/16                          â•‘    â•‘
â•‘    â•‘                                        VLAN 101                                             â•‘    â•‘
â•‘    â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£    â•‘
â•‘    â•‘                                                                                             â•‘    â•‘
â•‘    â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â•‘    â•‘
â•‘    â•‘   â”‚  ğŸ›¡ï¸ BASTION       â”‚      â”‚  ğŸ’» APP SERVER    â”‚      â”‚  ğŸ’» APP SERVER    â”‚                 â•‘    â•‘
â•‘    â•‘   â”‚  (The Bastion)   â”‚      â”‚     PAR-A-1      â”‚      â”‚     PAR-B-1      â”‚                 â•‘    â•‘
â•‘    â•‘   â”‚                  â”‚      â”‚                  â”‚      â”‚                  â”‚                 â•‘    â•‘
â•‘    â•‘   â”‚  10.101.3.50     â”‚â”€SSHâ”€â–¶â”‚  10.101.1.x      â”‚      â”‚  10.101.2.x      â”‚                 â•‘    â•‘
â•‘    â•‘   â”‚  + Ext-Net IP    â”‚      â”‚  + Floating IP   â”‚      â”‚  + Floating IP   â”‚                 â•‘    â•‘
â•‘    â•‘   â”‚                  â”‚      â”‚                  â”‚      â”‚                  â”‚                 â•‘    â•‘
â•‘    â•‘   â”‚  ğŸ‡«ğŸ‡· French IPs   â”‚      â”‚  Ubuntu 24.04   â”‚      â”‚  Ubuntu 24.04   â”‚                 â•‘    â•‘
â•‘    â•‘   â”‚  Only Access     â”‚      â”‚  Laravel + Nginx â”‚      â”‚  Laravel + Nginx â”‚                 â•‘    â•‘
â•‘    â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â•‘    â•‘
â•‘    â•‘            â”‚                         â”‚                         â”‚                           â•‘    â•‘
â•‘    â•‘            â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â•‘    â•‘
â•‘    â•‘            â”‚                                      â”‚                                        â•‘    â•‘
â•‘    â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚                                        â•‘    â•‘
â•‘    â•‘   â”‚  ğŸ”„ CI SERVER     â”‚                           â”‚                                        â•‘    â•‘
â•‘    â•‘   â”‚                  â”‚                           â”‚                                        â•‘    â•‘
â•‘    â•‘   â”‚  10.101.3.60     â”‚                           â”‚                                        â•‘    â•‘
â•‘    â•‘   â”‚  Private Only    â”‚                           â”‚                                        â•‘    â•‘
â•‘    â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚                                        â•‘    â•‘
â•‘    â•‘                                                  â”‚                                        â•‘    â•‘
â•‘    â•‘                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â•‘    â•‘
â•‘    â•‘                           â”‚                                             â”‚                 â•‘    â•‘
â•‘    â•‘                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”        â•‘    â•‘
â•‘    â•‘                  â”‚  ğŸ˜ POSTGRESQL    â”‚                       â”‚  âš¡ VALKEY          â”‚        â•‘    â•‘
â•‘    â•‘                  â”‚  (Managed HA)    â”‚                       â”‚  (Managed HA)      â”‚        â•‘    â•‘
â•‘    â•‘                  â”‚                  â”‚                       â”‚                    â”‚        â•‘    â•‘
â•‘    â•‘                  â”‚  v18 Production  â”‚                       â”‚  v8.1 Production   â”‚        â•‘    â•‘
â•‘    â•‘                  â”‚  2-Node Cluster  â”‚                       â”‚  2-Node Cluster    â”‚        â•‘    â•‘
â•‘    â•‘                  â”‚  ğŸ”’ Private Only  â”‚                       â”‚  ğŸ”’ Private Only    â”‚        â•‘    â•‘
â•‘    â•‘                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â•‘    â•‘
â•‘    â•‘                                                                                           â•‘    â•‘
â•‘    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â•‘
â•‘                                                                                                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                    ğŸ“¦ OVH OBJECT STORAGE (S3)                                         â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                                       â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â•‘
â•‘   â”‚     ğŸ—‚ï¸ PRIMARY BUCKET            â”‚    Replication    â”‚     ğŸ—‚ï¸ REPLICA BUCKET            â”‚          â•‘
â•‘   â”‚        EU-WEST-PAR              â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–¶  â”‚         GRA (Backup)            â”‚          â•‘
â•‘   â”‚                                 â”‚                   â”‚                                 â”‚          â•‘
â•‘   â”‚   âœ… Versioning Enabled         â”‚                   â”‚   âœ… Auto-created by OVH        â”‚          â•‘
â•‘   â”‚   âœ… SSE-S3 Encryption          â”‚                   â”‚   âœ… Cross-region DR            â”‚          â•‘
â•‘   â”‚   âœ… CORS Configured            â”‚                   â”‚   âœ… Disaster Recovery          â”‚          â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â•‘
â•‘                     â–²                                                                                 â•‘
â•‘                     â”‚ S3 API (HTTPS)                                                                  â•‘
â•‘                     â”‚                                                                                 â•‘
â•‘            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                        â•‘
â•‘            â”‚   App Servers   â”‚                                                                        â•‘
â•‘            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                ğŸ“Š OVH LOGS DATA PLATFORM (LDP)                                        â•‘
â•‘                                   Centralized Observability                                           â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                                       â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘   â”‚                                                                                                 â”‚ â•‘
â•‘   â”‚   ğŸ“ Application Logs (Laravel)     ğŸ“ System Logs (syslog)      ğŸ“ Security Events           â”‚ â•‘
â•‘   â”‚   ğŸ“ Nginx Access/Error Logs        ğŸ“ PostgreSQL Logs           ğŸ“ Bastion Audit Logs        â”‚ â•‘
â•‘   â”‚                                                                                                 â”‚ â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                 â–²                    â–²                    â–²                    â–²                      â•‘
â•‘                 â”‚                    â”‚                    â”‚                    â”‚                      â•‘
â•‘        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”                â•‘
â•‘        â”‚ App Servers â”‚      â”‚   Bastion   â”‚      â”‚  CI Server  â”‚      â”‚  PostgreSQL â”‚                â•‘
â•‘        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ”’ Security Architecture

### Defense-in-Depth Model

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                              ğŸ›¡ï¸ SECURITY LAYERS                                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                            â•‘
â•‘   LAYER 1: PERIMETER                                                                       â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘   â”‚  â˜ï¸ Cloudflare DDoS Protection  â”‚  ğŸŒ Geo-restriction (French IPs for SSH)         â”‚  â•‘
â•‘   â”‚  ğŸ” TLS 1.3 Encryption          â”‚  ğŸš« Rate Limiting                                â”‚  â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                                                                            â•‘
â•‘   LAYER 2: NETWORK                                                                         â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘   â”‚  ğŸ”’ Private vRack Network       â”‚  ğŸ›¡ï¸ Security Groups (Firewall)                   â”‚  â•‘
â•‘   â”‚  ğŸšª Bastion-only SSH Access     â”‚  ğŸ“ IP Whitelisting (Forge)                      â”‚  â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                                                                            â•‘
â•‘   LAYER 3: APPLICATION                                                                     â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘   â”‚  ğŸ”‘ SSH Key Authentication      â”‚  ğŸ‘¤ Role-based Access (The Bastion)              â”‚  â•‘
â•‘   â”‚  ğŸ“ Session Recording           â”‚  ğŸ” Full Audit Trail                             â”‚  â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                                                                            â•‘
â•‘   LAYER 4: DATA                                                                            â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘   â”‚  ğŸ” Encryption at Rest (SSE-S3) â”‚  ğŸ”’ Encryption in Transit (TLS)                  â”‚  â•‘
â•‘   â”‚  ğŸ—„ï¸ Database IP Restrictions    â”‚  ğŸ’¾ Automated Encrypted Backups                  â”‚  â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                                                                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Network Access Matrix

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                              ğŸŒ EXTERNAL ACCESS (Ext-Net)                                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  Component          â•‘  Access Rules                                                       â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  âš–ï¸ Load Balancer    â•‘  :80 â†’ HTTPS redirect | :443 HTTPS | :49984 IoT TCP â† ANY          â•‘
â•‘  ğŸ›¡ï¸ Bastion          â•‘  :22 SSH â† ğŸ‡«ğŸ‡· French IP Ranges Only                                â•‘
â•‘  ğŸ’» App Servers      â•‘  :22 SSH â† Laravel Forge IPs (159.203.150.x, 45.55.124.124)        â•‘
â•‘  ğŸ’» App Servers      â•‘  :80/:443 HTTP/S â† ANY (via Floating IP)                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                           ğŸ” INTERNAL ACCESS (Private vRack)                               â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  Component          â•‘  Access Rules                                                       â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  ğŸ’» App Servers      â•‘  :22 SSH â† Bastion (10.101.3.50/32)                                 â•‘
â•‘  ğŸ’» App Servers      â•‘  :443 HTTPS â† Load Balancer Pool (10.101.0.0/16)                   â•‘
â•‘  ğŸ’» App Servers      â•‘  :49984 IoT TCP â† Load Balancer Pool (10.101.0.0/16)               â•‘
â•‘  ğŸ”„ CI Server        â•‘  :22 SSH â† Bastion (10.101.3.50/32)                                 â•‘
â•‘  ğŸ˜ PostgreSQL       â•‘  :20184 â† Private Network CIDR Only (10.101.0.0/16)                â•‘
â•‘  âš¡ Valkey           â•‘  :20185 â† Private Network CIDR Only (10.101.0.0/16)                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ§© Components

| Component | Description | Configuration | Security |
|-----------|-------------|---------------|----------|
| **âš–ï¸ Load Balancer** | OVHcloud Load Balancer with floating IP | HTTPâ†’HTTPS redirect, IoT TCP :49984, Round Robin | TLS termination, Health checks |
| **ğŸ’» App Servers** | Ubuntu 24.04 application servers | Multi-AZ (PAR-A, PAR-B), Laravel + Nginx | Security groups, Bastion SSH |
| **ğŸ›¡ï¸ Bastion** | [The Bastion](https://github.com/ovh/the-bastion) SSH gateway | Dual-homed (private + public) | French IPs only, Session recording |
| **ğŸ”„ CI Server** | Continuous integration runner | Private network only | Bastion-only access |
| **ğŸ˜ PostgreSQL** | OVH Managed PostgreSQL 18 | 2-node HA, Production plan | Private network, Deletion protection |
| **âš¡ Valkey** | OVH Managed Valkey 8.1 (Redis-compatible) | 2-node HA, Production plan | Private network, Deletion protection |
| **ğŸ“¦ S3 Storage** | OVH Object Storage | EU-WEST-PAR â†’ GRA replication | SSE-S3 encryption, Versioning |
| **â˜ï¸ DNS** | Cloudflare DNS | Direct for bastion, Proxied for LB | DDoS protection |
| **ğŸ“Š LDP** | OVH Logs Data Platform | Centralized logging | Audit trails |

---

## ğŸŒ Network Topology

### Private Network (vRack)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    PRIVATE NETWORK CONFIGURATION                               â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                â•‘
â•‘   Network CIDR:     10.101.0.0/16                                              â•‘
â•‘   VLAN ID:          101                                                        â•‘
â•‘   DHCP:             Enabled (10.101.0.10 - 10.101.0.99)                        â•‘
â•‘   Gateway:          Router connected to Ext-Net                                â•‘
â•‘                                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### IP Addressing Scheme

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                         IP ADDRESS ALLOCATION                                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  Host Type                     â•‘  IP Range / Address                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  ğŸ“‹ DHCP Pool                   â•‘  10.101.0.10 - 10.101.0.99                   â•‘
â•‘  ğŸ’» App Servers (Zone A)        â•‘  10.101.1.x                                  â•‘
â•‘  ğŸ’» App Servers (Zone B)        â•‘  10.101.2.x                                  â•‘
â•‘  ğŸ›¡ï¸ Bastion                     â•‘  10.101.3.50                                 â•‘
â•‘  ğŸ”„ CI Server                   â•‘  10.101.3.60                                 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ” Access Control & Security

### Zero-Trust SSH Access Model

This infrastructure implements a **zero-trust SSH access model** using [OVH The Bastion](https://github.com/ovh/the-bastion).

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                              SSH ACCESS FLOW                                               â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                            â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘   â”‚                  â”‚   SSH   â”‚                          â”‚   SSH   â”‚                  â”‚  â•‘
â•‘   â”‚   ğŸ‘¤ Developer    â”‚ â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   ğŸ›¡ï¸ Bastion Server       â”‚ â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   ğŸ’» Target Serverâ”‚  â•‘
â•‘   â”‚   (French IP)    â”‚         â”‚   (The Bastion)          â”‚         â”‚                  â”‚  â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                          â”‚                                                 â•‘
â•‘                                          â”‚ Provides:                                       â•‘
â•‘                                          â”‚                                                 â•‘
â•‘                                          â”œâ”€â–¶ ğŸ”‘ Authentication (SSH Keys)                  â•‘
â•‘                                          â”œâ”€â–¶ ğŸ”’ Authorization (Fine-grained ACL)           â•‘
â•‘                                          â”œâ”€â–¶ ğŸ“¹ Session Recording (ttyrec)                 â•‘
â•‘                                          â”œâ”€â–¶ ğŸ“ Audit Logging (syslog)                     â•‘
â•‘                                          â””â”€â–¶ ğŸ›¡ï¸ Protocol Break (Security)                  â•‘
â•‘                                                                                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

#### Connecting via Bastion

```bash
# Direct connection through bastion (ProxyJump)
ssh -J bastion.potti.fr user@target-server

# Using The Bastion's native commands
ssh user@bastion.potti.fr -t -- user@target-server
```

### Security Groups

| Security Group | Purpose | Rules |
|----------------|---------|-------|
| `bastion_access_secgroup` | SSH from bastion | Ingress TCP/22 from 10.101.3.50/32 |
| `bastion_french_only_secgroup` | Geo-restricted bastion access | Ingress TCP/22 from French IP ranges |
| `forge_access_secgroup` | Laravel Forge SSH access | Ingress TCP/22 from Forge IPs |
| `web_access_secgroup` | Internal web & IoT traffic | Ingress TCP/443, TCP/49984 from 10.101.0.0/16 |
| `app_tcp_direct_secgroup` | Direct app server access | Ingress TCP/80, TCP/443 from 0.0.0.0/0 |
| `tailscale_secgroup` | Tailscale VPN | UDP/41641, UDP/3478 from 0.0.0.0/0 |

### Database Security

- âœ… PostgreSQL and Valkey restricted to private network CIDR (`10.101.0.0/16`)
- âœ… No public endpoints exposed
- âœ… Deletion protection enabled
- âœ… High-availability with 2-node clusters
- âœ… Automated backups to multiple regions (EU-WEST-PAR, GRA)

---

## ğŸ”§ Application Server Management

Application servers are provisioned and managed using **[Laravel Forge](https://forge.laravel.com/)**.

### What Forge Manages

| Capability | Description |
|------------|-------------|
| ğŸ–¥ï¸ **Server Provisioning** | Initial Ubuntu setup, PHP, Nginx configuration |
| ğŸš€ **Deployments** | Git-based deployments with zero-downtime |
| ğŸ” **SSL Certificates** | Automatic Let's Encrypt management |
| âš™ï¸ **Queue Workers** | Supervisor configuration for Laravel queues |
| â° **Scheduled Tasks** | Cron job management |
| ğŸ’¾ **Database Backups** | Automated backup scheduling |
| ğŸ“Š **Monitoring** | Server health and resource monitoring |

### Forge Access

Forge connects to app servers via SSH using whitelisted IP addresses:

```
159.203.150.232  â”‚  45.55.124.124  â”‚  159.203.150.216  â”‚  165.227.248.218
```

### Access Hierarchy

| Access Type | Method | Purpose |
|-------------|--------|---------|
| **ğŸ‘¤ Developer SSH** | Via The Bastion | Debugging, maintenance, emergency access |
| **ğŸ¤– Forge Automated** | Direct SSH (whitelisted IPs) | Deployments, server management |
| **ğŸŒ Application Traffic** | Via Load Balancer | Production web traffic |

---

## ğŸ“¦ Object Storage (S3)

### Storage Architecture

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                              S3 STORAGE ARCHITECTURE                                       â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                            â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Cross-Region     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘   â”‚     ğŸ—‚ï¸ PRIMARY BUCKET            â”‚    Replication      â”‚     ğŸ—‚ï¸ REPLICA BUCKET        â”‚ â•‘
â•‘   â”‚        EU-WEST-PAR              â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–¶â”‚         GRA                 â”‚ â•‘
â•‘   â”‚                                 â”‚                     â”‚                             â”‚ â•‘
â•‘   â”‚   âœ… Versioning: Enabled        â”‚                     â”‚   âœ… Storage: STANDARD_IA   â”‚ â•‘
â•‘   â”‚   âœ… Encryption: AES256         â”‚                     â”‚   âœ… Auto-managed by OVH    â”‚ â•‘
â•‘   â”‚   âœ… CORS: potti.co domains     â”‚                     â”‚   âœ… Disaster Recovery      â”‚ â•‘
â•‘   â”‚   âœ… Delete Markers: Replicated â”‚                     â”‚                             â”‚ â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                                                                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Features

| Feature | Configuration |
|---------|---------------|
| **Cross-region Replication** | EU-WEST-PAR â†’ GRA for disaster recovery |
| **Versioning** | Enabled - protects against accidental deletions |
| **Encryption** | Server-side encryption (SSE-S3/AES256) |
| **CORS** | Configured for `potti.co` and `staging.potti.co` |

### S3 Endpoint

```
https://s3.eu-west-par.io.cloud.ovh.net
```

---

## ğŸ“Š Observability & Logging

All infrastructure components ship logs to **[OVH Logs Data Platform (LDP)](https://help.ovhcloud.com/csm/fr-documentation-observability-logs-data-platform)**.

### Log Sources

| Source | Log Types |
|--------|-----------|
| **ğŸ’» App Servers** | Laravel application logs, Nginx access/error logs |
| **ğŸ›¡ï¸ Bastion** | SSH session logs, audit trails, access attempts |
| **ğŸ”„ CI Server** | Build logs, deployment logs |
| **ğŸ˜ PostgreSQL** | Query logs, slow queries, connection logs |
| **âš¡ Valkey** | Cache operations, connection logs |

### Benefits

- ğŸ” **Centralized Search**: Query logs across all services from a single interface
- ğŸ“… **Retention**: Configurable log retention policies
- ğŸš¨ **Alerting**: Set up alerts on error patterns or anomalies
- âœ… **Compliance**: Audit trail for security and compliance requirements
- ğŸ”— **Correlation**: Trace requests across services using correlation IDs

---

## ğŸŒ DNS Configuration

| Record | Type | Target | Proxied |
|--------|------|--------|---------|
| `bastion.potti.fr` | A | Bastion public IP | âŒ No |
| `potti.co` | A | Load Balancer floating IP | âŒ No |

---

## ğŸ“ Terraform Resources

### Files Overview

| File | Purpose |
|------|---------|
| `provider.tf` | OVH, OpenStack, and Cloudflare provider configuration |
| `variable.tf` | Input variables and defaults |
| `locals.tf` | Computed local values |
| `network.tf` | Private network, subnet, router |
| `rules.tf` | Security groups and firewall rules |
| `bastion.tf` | Bastion server instance |
| `instance.tf` | Application server instances |
| `ci.tf` | CI server instance |
| `load-balancer.tf` | Load balancer, listeners, pools, health checks |
| `database.tf` | Managed PostgreSQL cluster |
| `cache.tf` | Managed Valkey cluster |
| `s3.tf` | Object storage bucket and credentials |
| `dns.tf` | Cloudflare DNS records |
| `ssh.tf` | SSH keypairs |
| `outputs.tf` | Terraform outputs |

---

## ğŸš€ Quick Start

```bash
# 1. Initialize Terraform
terraform init

# 2. Copy and configure variables
cp my_vars.tfvarexample my_vars.tfvars
# Edit my_vars.tfvars with your credentials

# 3. Plan changes
terraform plan -var-file=my_vars.tfvars

# 4. Apply changes
terraform apply -var-file=my_vars.tfvars
```

---

## ğŸ”„ High Availability

| Component | HA Strategy | RTO |
|-----------|-------------|-----|
| **ğŸ’» App Servers** | Multiple instances across AZs (PAR-A, PAR-B) | < 30s |
| **âš–ï¸ Load Balancer** | OVHcloud managed with health checks | Automatic |
| **ğŸ˜ PostgreSQL** | 2-node cluster with automatic failover | < 60s |
| **âš¡ Valkey** | 2-node cluster with automatic failover | < 60s |
| **ğŸ“¦ S3 Storage** | Cross-region replication (PAR â†’ GRA) | N/A |
| **ğŸ›¡ï¸ Bastion** | Single instance (manual recovery) | Manual |

---

## ğŸ“¡ Monitoring & Health Checks

| Component | Check Type | Interval | Timeout | Retries |
|-----------|------------|----------|---------|---------|
| **Load Balancer HTTPS** | HTTP `/up` | 10s | 5s | 3 |
| **Load Balancer IoT** | TCP :49984 | 10s | 5s | 3 |
| **Forge** | Server metrics | Continuous | - | - |
| **The Bastion** | Session recording | Real-time | - | - |

---

## ğŸ“¡ IoT Sensor Integration

### Configuration

| Setting | Value |
|---------|-------|
| **Protocol** | TCP |
| **Port** | 49984 |
| **Load Balancing** | Round Robin |
| **Health Check** | TCP (10s interval, 5s timeout, 3 retries) |

### Architecture

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          IoT DATA INGESTION FLOW                               â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘   â”‚                  â”‚ TCP  â”‚                  â”‚ TCP  â”‚                  â”‚    â•‘
â•‘   â”‚   ğŸ“¡ IoT Sensors  â”‚â”€â”€â”€â”€â”€â–¶â”‚   âš–ï¸ Load Balancerâ”‚â”€â”€â”€â”€â”€â–¶â”‚   ğŸ’» App Servers  â”‚    â•‘
â•‘   â”‚                  â”‚:49984â”‚                  â”‚:49984â”‚                  â”‚    â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•‘                                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Connection

```
<load-balancer-floating-ip>:49984
```

---

## âœ… Compliance

For detailed data policies and compliance documentation, see **[DATA_POLICIES.md](./DATA_POLICIES.md)**.

---

## ğŸ“š References

- [OVH The Bastion](https://github.com/ovh/the-bastion) - SSH access gateway
- [Laravel Forge](https://forge.laravel.com/) - Server management platform
- [OVHcloud Public Cloud](https://www.ovhcloud.com/en/public-cloud/) - Cloud infrastructure
- [OVH Logs Data Platform](https://help.ovhcloud.com/csm/fr-documentation-observability-logs-data-platform) - Centralized logging
- [Cloudflare](https://www.cloudflare.com/) - DNS and CDN
